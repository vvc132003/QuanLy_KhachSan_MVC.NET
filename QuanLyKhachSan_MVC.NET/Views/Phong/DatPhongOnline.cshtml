@model Model.Models.Modeldata
<link href="/static/img/favicon.ico" rel="icon">
<link href="/static/img/apple-favicon.png" rel="apple-touch-icon">
<link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link href="~/css/bootstrap.min.css" rel="stylesheet" />
<link href="~/css/font-awesome.min.css" rel="stylesheet" />
<link href="~/css/animate.min.css" rel="stylesheet" />
<link href="~/css/slick.css" rel="stylesheet" />
<link href="~/css/slick-theme.css" rel="stylesheet" />
<link href="~/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />
<link href="~/css/hover-style.css" rel="stylesheet" />
<link href="~/css/style.css" rel="stylesheet" />
@Html.Partial("~/Views/layout/index.cshtml")
<div id="booking">
    <div class="container">
        <div class="section-header">
            <h2>Đặt phòng</h2>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="booking-form">
                    <div id="success">
                        @if (Model.phong != null)
                        {
                            @if (Model.phong.tinhtrangphong == "có khách" || Model.phong.tinhtrangphong == "đã đặt")
                            {
                                <p style="color:red; font-size:14px; font-weight:600;">
                                    Phòng đang có khách, vui lòng quay lại sau: @(Model.datPhong?.ngaydukientra.ToString("dd/MM/yyyy HH:mm") ?? "không rõ thời gian").
                                </p>
                            }
                            else if (Model.phong.tinhtrangphong == "còn trống")
                            {
                                <p style="font-size:14px; font-weight:600;">Xin chào bạn đến với khách sạn chúng tôi.</p>
                            }
                        }
                        else
                        {
                            <p style="color:red; font-size:14px; font-weight:600;">Phòng không sử dụng, vui lòng quay lại sau.</p>
                        }

                    </div>
                    @if (!string.IsNullOrEmpty(ViewData["thongbaothuephongonline"] as string))
                    {
                        <div class="alert alert-danger" role="alert">
                            <p>@ViewData["thongbaothuephongonline"]</p>
                        </div>
                    }
                    <br />
                    <form method="post" action="/ThuePhong/CheckInDatPhongOnline">
                        <input type="hidden" id="idphong" name="idphong" value="@((Model.phong != null) ? Model.phong.id : "")" class="form-control" />
                        <input type="hidden" id="idkhachsan" name="idkhachsan" value="@((Model.phong != null) ? Model.phong.id : "")" class="form-control" />
                        <div class="form-row">
                            <div class="control-group col-md-6">
                                <label>Họ và tên</label>
                                @if (Model.khachhang != null && !string.IsNullOrEmpty(Model.khachhang.hovaten))
                                {
                                    <input type="text" class="form-control" id="hovaten" name="hovaten" value="@Model.khachhang.hovaten" required="required" data-validation-required-message="Vui lòng nhập họ tên" />
                                }
                                else if (!string.IsNullOrEmpty(Model.userProfileViewModel?.Name))
                                {
                                    <input type="text" class="form-control" id="hovaten" name="hovaten" value="@Model.userProfileViewModel.Name" required="required" data-validation-required-message="Vui lòng nhập họ tên" />
                                }
                                else
                                {
                                    <input type="text" class="form-control" id="hovaten" name="hovaten" required="required" data-validation-required-message="Vui lòng nhập họ tên" />
                                }
                                <p class="help-block text-danger"></p>
                            </div>
                            <div class="control-group col-md-6">
                                <label>Email</label>
                                @if (Model.khachhang != null && !string.IsNullOrEmpty(Model.khachhang.hovaten))
                                {
                                    <input type="email" name="email" class="form-control" id="email" value="@Model.khachhang.email" required="required" data-validation-required-message="Vui lòng nhập email(*)" />
                                }
                                else if (!string.IsNullOrEmpty(Model.userProfileViewModel?.Name))
                                {
                                    <input type="email" name="email" class="form-control" id="email" value="@Model.userProfileViewModel.Email" required="required" data-validation-required-message="Vui lòng nhập email(*)" />
                                }
                                else
                                {
                                    <input type="email" name="email" class="form-control" id="email" required="required" data-validation-required-message="Vui lòng nhập email(*)" />
                                }
                                <p class="help-block text-danger"></p>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="control-group col-md-6">
                                <label>Số điện thoại</label>
                                @if (Model.khachhang != null && !string.IsNullOrEmpty(Model.khachhang.hovaten))
                                {
                                    <input type="text" class="form-control" id="sodienthoai" value="@Model.khachhang.sodienthoai" name="sodienthoai" required="required" data-validation-required-message="Vui lòng nhập số điện thoại" />
                                }
                                else
                                {
                                    <input type="text" class="form-control" id="sodienthoai" name="sodienthoai" required="required" data-validation-required-message="Vui lòng nhập số điện thoại" />
                                }
                                <p class="help-block text-danger"></p>
                            </div>
                            <div class="control-group col-md-6">
                                <label>CCCD</label>
                                @if (Model.khachhang != null && !string.IsNullOrEmpty(Model.khachhang.hovaten))
                                {
                                    <input type="text" class="form-control" id="cccd" value="@Model.khachhang.cccd" name="cccd" required="required" data-validation-required-message="Vui lòng nhập cccd (*)" />
                                }
                                else
                                {
                                    <input type="text" class="form-control" id="cccd" name="cccd" required="required" data-validation-required-message="Vui lòng nhập cccd (*)" />
                                }
                                <p class="help-block text-danger"></p>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="control-group col-md-6">
                                <label>Ngày dự kiến trả phòng</label>
                                <input type="datetime" class="form-control datetimepicker-input" id="date-1" name="ngaydukientra" data-toggle="datetimepicker" data-target="#date-1" required="required" data-validation-required-message="Vui lòng nhập ngày dự kiến trả" />
                                <p class="help-block text-danger"></p>
                            </div>
                            <div class="control-group col-md-6">
                                <label>Mã giảm giá (Nếu có)</label>
                                <input type="text" class="form-control datetimepicker-input" id="magiamgia" name="magiamgia" data-toggle="datetimepicker" />
                                <p class="help-block text-danger"></p>
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Yêu cầu</label>
                            <input type="text" class="form-control" id="request" required="required" data-validation-required-message="Vui lòng nhập yêu cầu" />
                            <p class="help-block text-danger"></p>
                        </div>
                        <div class="button"><button type="submit" id="bookingButton">Đặt phòng</button></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="likesSummary" class="likes-container">
    <div class="likes-count">
        <span id="totalLikes">0</span> <i id="likeIcon" class="icon" style="display: block;"></i>
    </div>
    <div class="reaction-icons">
        <i class="far fa-thumbs-up icon" data-reaction="like" data-icon="far fa-thumbs-up"></i>
        <i class="fas fa-heart icon" data-reaction="love" data-icon="fas fa-heart"></i>
        <i class="far fa-laugh icon" data-reaction="haha" data-icon="far fa-laugh"></i>
        <i class="far fa-surprise icon" data-reaction="wow" data-icon="far fa-surprise"></i>
        <i class="far fa-sad-tear icon" data-reaction="sad" data-icon="far fa-sad-tear"></i>
        <i class="far fa-angry icon" data-reaction="angry" data-icon="far fa-angry"></i>
    </div>
    <p id="thongbao" style="color:red;"></p>
</div>
<hr />
<div class="comment-container" style="padding: 100px;">
    <div class="alert alert-success" style="display:none;">
    </div>
    <div class="comment-form">
        <div>
            @if (Model.khachhang != null && !string.IsNullOrEmpty(Model.khachhang.hovaten))
            {
                <label for="comment">@Model.khachhang.hovaten:</label>
            }
            else
            {
                <label for="comment">Your Comment:</label>  
            }
            <textarea id="comment" name="comment" rows="4" required></textarea>
        </div>
        <button id="add-comment-btn">Gửi</button>
    </div>
</div>
<style>
    .comment {
        display: flex;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        padding: 15px;
    }

    .avatar {
        width: 60px;
        height: 60px;
        overflow: hidden;
        border-radius: 50%;
        margin-right: 15px;
    }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    .comment-content {
        flex-grow: 1;
    }

    .comment-meta {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
    }

    .username {
        font-weight: bold;
        color: #333;
    }

    .timestamp {
        color: #666;
    }

    .comment-text {
        color: #333;
        line-height: 1.6;
    }

    .comment-form {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 15px;
        margin-top: 20px;
    }

        .comment-form h2 {
            margin-bottom: 10px;
        }

        .comment-form label {
            display: block;
            margin-bottom: 8px;
        }

        .comment-form input[type="text"],
        .comment-form textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .comment-form textarea {
            resize: vertical;
        }

        .comment-form button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

            .comment-form button:hover {
                background-color: #45a049;
            }

    #likesSummary {
        border: 1px solid #ccc;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        width: 300px;
        margin: 0 auto; /* Center the container */
        text-align: center;
    }

    .likes-container {
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 20px;
        text-align: center;
        max-width: 300px;
        position: relative;
    }

    .likes-count {
        font-size: 1.5em;
        margin-bottom: 10px;
        cursor: pointer;
    }

    .reaction-icons {
        display: none;
        position: absolute;
        top: 0%;
        left: 50%;
        transform: translateX(-50%);
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 10px;
        flex-direction: row;
        gap: 10px;
    }

    .icon {
        font-size: 30px;
        cursor: pointer;
        transition: transform 0.2s;
    }

        .icon:hover {
            transform: scale(1.2);
        }

    .likes-count:hover + .reaction-icons,
    .reaction-icons:hover {
        display: flex;
    }
</style>
@Html.Partial("~/Views/layout/footer.cshtml")
<script src="~/content/static/vendor/jquery/jquery.min.js"></script>
<script src="~/content/static/vendor/jquery/jquery-migrate.min.js"></script>
<script src="~/content/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="~/content/static/vendor/easing/easing.min.js"></script>
<script src="~/content/static/vendor/stickyjs/sticky.js"></script>
<script src="~/content/static/vendor/superfish/hoverIntent.js"></script>
<script src="~/content/static/vendor/superfish/superfish.min.js"></script>
<script src="~/content/static/vendor/wow/wow.min.js"></script>
<script src="~/content/static/vendor/slick/slick.min.js"></script>
<script src="~/content/static/vendor/tempusdominus/js/moment.min.js"></script>
<script src="~/content/static/vendor/tempusdominus/js/moment-timezone.min.js"></script>
<script src="~/content/static/vendor/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
<script src="~/content/static/js/booking.js"></script>
<script src="~/content/static/js/jqBootstrapValidation.min.js"></script>
<script src="~/content/static/js/main.js"></script>

<script>
    $(document).ready(function () {
        function loadLikesCount() {
            $.ajax({
                type: "GET",
                url: "/Likes/CountLikeByIdPhong",
                data: { idphong: @((Model.phong != null) ? Model.phong.id : "") },
                success: function (result) {
                    $("#totalLikes").text(result.sumlikesidphong);
                    $("#likeIcon").html('<i class="' + result.icon + ' icon"></i>');
                },
                error: function (error) {
                    console.error(error);
                }
            });
        }

        loadLikesCount();

        $(".icon").click(function () {
            var reaction = $(this).data("icon");
            $.ajax({
                type: "GET",
                url: "/Likes/LikesPhong",
                data: { idphong: @((Model.phong != null) ? Model.phong.id : ""), icon: reaction },
                success: function (data) {
                    loadLikesCount();
                    if (data.thongbao != null) {
                        $("#thongbao").html('Vui lòng ' + '<a href="/dangnhap/dangnhap">Đăng nhập</a>' + ' trước khi like !');
                    }
                },
                error: function (error) {
                    console.error(error);
                }
            });
        });
    });
</script>

<script>
    $(document).ready(function () {
        function loadComments() {
            $.ajax({
                url: "/binhluan/GetBinhLuanByIdPhong",
                data: { idphong: @((Model.phong != null) ? Model.phong.id : "") },
                type: 'GET',
                success: function (data) {
                    data.forEach(function (item) {
                        var commentHtml = '<div class="comment">' +
                            '<div class="avatar">' +
                            '<img src="avatar.jpg" alt="Avatar">' +
                            '</div>' +
                            '<div class="comment-content">' +
                            '<div class="comment-meta">' +
                            '<span class="username">' + item.khachHang.hovaten + '</span>' +
                            '<span class="timestamp">' + formatDate(item.binhLuan.thoigianbinhluan) + '</span>' +
                            '</div>' +
                            '<p class="comment-text">' + item.binhLuan.noidung + '</p>' +
                            '</div>' +
                            '</div>';
                        $('.comment-container').prepend(commentHtml);
                        // $('.comment-container').append(commentHtml); // Thêm bình luận mới vào .comment-container
                    });
                },
                error: function (error) {
                    console.log('Error:', error);
                }
            });
        }
        loadComments();
        // Hàm format thời gian
        function formatDate(dateStr) {
            var date = new Date(dateStr);
            return date.getDate() + '/' + (date.getMonth() + 1) + '/' + date.getFullYear();
        }

        $("#add-comment-btn").click(function () {
            var comment = $("#comment").val();
            $.ajax({
                type: "POST",
                url: "/binhluan/addbinhluan",
                data: { idphong: @((Model.phong != null) ? Model.phong.id : ""), noidung: comment },
                success: function (data) {
                    $("#comment").val('');
                    if (data.success) {
                        // Hiển thị thông báo thành công
                        $('.alert-success').text(data.message).show();
                        // Sau 5 giây tự động ẩn thông báo
                        setTimeout(function () {
                            $('.alert-success').fadeOut('fast');
                        }, 5000);
                    }
                },
                error: function (error) {
                    console.error(error);
                }
            });
        });
    });

</script>