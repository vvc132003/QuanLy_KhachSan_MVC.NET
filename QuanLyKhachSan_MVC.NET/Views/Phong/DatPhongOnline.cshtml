@model Model.Models.Modeldata
<link href="/static/img/favicon.ico" rel="icon">
<link href="/static/img/apple-favicon.png" rel="apple-touch-icon">
<link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link href="~/css/bootstrap.min.css" rel="stylesheet" />
<link href="~/css/font-awesome.min.css" rel="stylesheet" />
<link href="~/css/animate.min.css" rel="stylesheet" />
<link href="~/css/slick.css" rel="stylesheet" />
<link href="~/css/slick-theme.css" rel="stylesheet" />
<link href="~/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />
<link href="~/css/hover-style.css" rel="stylesheet" />
<link href="~/css/style.css" rel="stylesheet" />
@Html.Partial("~/Views/layout/index.cshtml")
<div id="booking">
    <div class="container">
        <div class="section-header">
            <h2>Đặt phòng</h2>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="booking-form">
                    <div id="success">
                        @if (Model.phong != null)
                        {
                            @if (Model.phong.tinhtrangphong == "có khách" || Model.phong.tinhtrangphong == "đã đặt")
                            {
                                <p style="color:red; font-size:14px; font-weight:600;">
                                    Phòng đang có khách, vui lòng quay lại sau: @(Model.datPhong?.ngaydukientra.ToString("dd/MM/yyyy HH:mm") ?? "không rõ thời gian").
                                </p>
                            }
                            else if (Model.phong.tinhtrangphong == "còn trống")
                            {
                                <p style="font-size:14px; font-weight:600;">Xin chào bạn đến với khách sạn chúng tôi.</p>
                            }
                        }
                        else
                        {
                            <p style="color:red; font-size:14px; font-weight:600;">Phòng không sử dụng, vui lòng quay lại sau.</p>
                        }

                    </div>
                    @if (!string.IsNullOrEmpty(ViewData["thongbaothuephongonline"] as string))
                    {
                        <div class="alert alert-danger" role="alert">
                            <p>@ViewData["thongbaothuephongonline"]</p>
                        </div>
                    }
                    <br />
                    <form method="post" action="/ThuePhong/CheckInDatPhongOnline">
                        <input type="hidden" id="idphong" name="idphong" value="@((Model.phong != null) ? Model.phong.id : "")" class="form-control" />
                        <input type="hidden" id="idkhachsan" name="idkhachsan" value="@((Model.phong != null) ? Model.phong.id : "")" class="form-control" />
                        <div class="form-row">
                            <div class="control-group col-md-6">
                                <label>Họ và tên</label>
                                @if (Model.khachhang != null && !string.IsNullOrEmpty(Model.khachhang.hovaten))
                                {
                                    <input type="text" class="form-control" id="hovaten" name="hovaten" value="@Model.khachhang.hovaten" required="required" data-validation-required-message="Vui lòng nhập họ tên" />
                                }
                                else if (!string.IsNullOrEmpty(Model.userProfileViewModel?.Name))
                                {
                                    <input type="text" class="form-control" id="hovaten" name="hovaten" value="@Model.userProfileViewModel.Name" required="required" data-validation-required-message="Vui lòng nhập họ tên" />
                                }
                                else
                                {
                                    <input type="text" class="form-control" id="hovaten" name="hovaten" required="required" data-validation-required-message="Vui lòng nhập họ tên" />
                                }
                                <p class="help-block text-danger"></p>
                            </div>
                            <div class="control-group col-md-6">
                                <label>Email</label>
                                @if (Model.khachhang != null && !string.IsNullOrEmpty(Model.khachhang.hovaten))
                                {
                                    <input type="email" name="email" class="form-control" id="email" value="@Model.khachhang.email" required="required" data-validation-required-message="Vui lòng nhập email(*)" />
                                }
                                else if (!string.IsNullOrEmpty(Model.userProfileViewModel?.Name))
                                {
                                    <input type="email" name="email" class="form-control" id="email" value="@Model.userProfileViewModel.Email" required="required" data-validation-required-message="Vui lòng nhập email(*)" />
                                }
                                else
                                {
                                    <input type="email" name="email" class="form-control" id="email" required="required" data-validation-required-message="Vui lòng nhập email(*)" />
                                }
                                <p class="help-block text-danger"></p>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="control-group col-md-6">
                                <label>Số điện thoại</label>
                                @if (Model.khachhang != null && !string.IsNullOrEmpty(Model.khachhang.hovaten))
                                {
                                    <input type="text" class="form-control" id="sodienthoai" value="@Model.khachhang.sodienthoai" name="sodienthoai" required="required" data-validation-required-message="Vui lòng nhập số điện thoại" />
                                }
                                else
                                {
                                    <input type="text" class="form-control" id="sodienthoai" name="sodienthoai" required="required" data-validation-required-message="Vui lòng nhập số điện thoại" />
                                }
                                <p class="help-block text-danger"></p>
                            </div>
                            <div class="control-group col-md-6">
                                <label>CCCD</label>
                                @if (Model.khachhang != null && !string.IsNullOrEmpty(Model.khachhang.hovaten))
                                {
                                    <input type="text" class="form-control" id="cccd" value="@Model.khachhang.cccd" name="cccd" required="required" data-validation-required-message="Vui lòng nhập cccd (*)" />
                                }
                                else
                                {
                                    <input type="text" class="form-control" id="cccd" name="cccd" required="required" data-validation-required-message="Vui lòng nhập cccd (*)" />
                                }
                                <p class="help-block text-danger"></p>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="control-group col-md-6">
                                <label>Ngày dự kiến trả phòng</label>
                                <input type="datetime" class="form-control datetimepicker-input" id="date-1" name="ngaydukientra" data-toggle="datetimepicker" data-target="#date-1" required="required" data-validation-required-message="Vui lòng nhập ngày dự kiến trả" />
                                <p class="help-block text-danger"></p>
                            </div>
                            <div class="control-group col-md-6">
                                <label>Mã giảm giá (Nếu có)</label>
                                <input type="text" class="form-control datetimepicker-input" id="magiamgia" name="magiamgia" data-toggle="datetimepicker" />
                                <p class="help-block text-danger"></p>
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Yêu cầu</label>
                            <input type="text" class="form-control" id="request" required="required" data-validation-required-message="Vui lòng nhập yêu cầu" />
                            <p class="help-block text-danger"></p>
                        </div>
                        <div class="button"><button type="submit" id="bookingButton">Đặt phòng</button></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="likesSummary" class="likes-container">
    <div class="likes-count">
        <span id="totalLikes">0</span> <i id="likeIcon" class="icon" style="display: block;"></i>
    </div>
    <div class="reaction-icons">
        <i class="far fa-thumbs-up icon" data-reaction="like" data-icon="far fa-thumbs-up"></i>
        <i class="fas fa-heart icon" data-reaction="love" data-icon="fas fa-heart"></i>
        <i class="far fa-laugh icon" data-reaction="haha" data-icon="far fa-laugh"></i>
        <i class="far fa-surprise icon" data-reaction="wow" data-icon="far fa-surprise"></i>
        <i class="far fa-sad-tear icon" data-reaction="sad" data-icon="far fa-sad-tear"></i>
        <i class="far fa-angry icon" data-reaction="angry" data-icon="far fa-angry"></i>
    </div>
    <p id="thongbao" style="color:red;"></p>
</div>
<hr />
<div class="comment-container" style="padding: 10px;max-width: 90%;margin: auto;">
    <div class="alert alert-success" style="display:none;">
    </div>
    <div class="alert alert-login " style="display:none;">
    </div>
    <div class="comment-input">
        @if (ViewData["hovaten"] != null)
        {
            <img src="" alt="@ViewData["hovaten"]" class="avatar">
        }
        else
        {
            <img src="" alt="" class="avatar">
        }
        <textarea id="main-input" class="inputnoidung" placeholder="Viết bình luận..."></textarea>
        <button id="add-comment-btn" type="submit">Gửi</button>
    </div>

    <div class="comments-list" id="comments-list">
        <!-- Bình luận sẽ được tải lên đây bởi AJAX -->
    </div>
</div>


<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Đăng nhập</h1>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="mb-3">
                        <input type="text" class="form-control taikhoanoremail" placeholder="Nhập tài khoản hoặc email" name="taikhoanoremail" required="">
                    </div>
                    <div class="mb-3">
                        <input type="password" class="form-control matkhau" placeholder="Mật kẩu" name="matkhau" required="">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Huỷ</button>
                <button type="button" id="loginsss" class="btn btn-primary">Đăng nhập</button>
            </div>
        </div>
    </div>
</div>

<style>
    .modal-backdrop {
        background-color: rgba(0, 0, 0, 0.5);
    }
</style>
<style>
    .alert-success {
        background-color: #d4edda; /* Màu nền xanh lá cây nhạt */
        border-color: #c3e6cb; /* Màu viền */
        color: #155724; /* Màu chữ */
        padding: 10px;
        display: none;
        margin-top: 10px;
    }

    .alert-login {
        background-color: #f8d7da; /* Màu nền đỏ nhạt */
        border-color: #f5c6cb; /* Màu viền */
        color: #721c24; /* Màu chữ */
        padding: 10px;
        display: none;
        margin-top: 10px;
    }

    /* Nút "Xem thêm" */
    .btn-view-more-replies,
    .btn-view-more-repliess {
        background-color: #007bff;
        color: #fff;
        border: none;
        padding: 8px 16px;
        font-size: 14px;
        cursor: pointer;
        border-radius: 4px;
        transition: background-color 0.3s ease;
    }

        .btn-view-more-replies:hover,
        .btn-view-more-repliess:hover {
            background-color: #0056b3;
        }

    .view-more-replies {
        margin-top: 10px;
        text-align: center;
    }

    .comment-input {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        background: white;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

        .comment-input .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .comment-input textarea {
            flex: 1;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            resize: none;
            font-size: 14px;
        }

        .comment-input button {
            margin-left: 10px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

            .comment-input button:hover {
                background-color: #0056b3;
            }

    .comments-list .comment {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
        background: white;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .comments-list .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
    }

    .comments-list .comment-body {
        flex: 1;
    }

    .comments-list .comment-header {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
    }

    .comments-list .username {
        font-weight: bold;
        margin-right: 10px;
        font-size: 14px;
    }

    .comments-list .time {
        color: #888;
        font-size: 12px;
    }

    .comments-list .comment-text {
        margin-bottom: 10px;
        font-size: 14px;
    }

    .comments-list .comment-actions button {
        margin-right: 10px;
        background: none;
        border: none;
        color: #007bff;
        cursor: pointer;
        font-size: 14px;
        transition: color 0.3s;
    }

        .comments-list .comment-actions button:hover {
            color: #0056b3;
        }

    .reply-input {
        display: none;
        margin-left: 50px;
        margin-top: 10px;
    }

    .replies-list {
        margin-left: 50px;
        margin-top: 10px;
    }

        .replies-list .comment {
            margin-bottom: 10px;
        }

    .reply-input .avatar {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        margin-right: 10px;
    }

    .reply-input textarea {
        flex: 1;
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
        resize: none;
        font-size: 14px;
    }

    .reply-input button {
        margin-left: 10px;
        padding: 5px 10px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

        .reply-input button:hover {
            background-color: #0056b3;
        }


    #likesSummary {
        border: 1px solid #ccc;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        width: 300px;
        margin: 0 auto; /* Center the container */
        text-align: center;
    }

    .likes-container {
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 20px;
        text-align: center;
        max-width: 300px;
        position: relative;
    }

    .likes-count {
        font-size: 1.5em;
        margin-bottom: 10px;
        cursor: pointer;
    }

    .reaction-icons {
        display: none;
        position: absolute;
        top: 0%;
        left: 50%;
        transform: translateX(-50%);
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 10px;
        flex-direction: row;
        gap: 10px;
    }

    .icon {
        font-size: 30px;
        cursor: pointer;
        transition: transform 0.2s;
    }

        .icon:hover {
            transform: scale(1.2);
        }

    .likes-count:hover + .reaction-icons,
    .reaction-icons:hover {
        display: flex;
    }
</style>
@Html.Partial("~/Views/layout/footer.cshtml")
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="~/content/static/vendor/jquery/jquery.min.js"></script>
<script src="~/content/static/vendor/jquery/jquery-migrate.min.js"></script>
<script src="~/content/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="~/content/static/vendor/easing/easing.min.js"></script>
<script src="~/content/static/vendor/stickyjs/sticky.js"></script>
<script src="~/content/static/vendor/superfish/hoverIntent.js"></script>
<script src="~/content/static/vendor/superfish/superfish.min.js"></script>
<script src="~/content/static/vendor/wow/wow.min.js"></script>
<script src="~/content/static/vendor/slick/slick.min.js"></script>
<script src="~/content/static/vendor/tempusdominus/js/moment.min.js"></script>
<script src="~/content/static/vendor/tempusdominus/js/moment-timezone.min.js"></script>
<script src="~/content/static/vendor/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
<script src="~/content/static/js/booking.js"></script>
<script src="~/content/static/js/jqBootstrapValidation.min.js"></script>
<script src="~/content/static/js/main.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    $(document).ready(function () {
        // Hàm gọi AJAX để lấy bình luận
        function loadComments(soluonghienthi) {
            $.ajax({
                url: '/binhluan/BinhLuanss/',
                data: { idphong: @((Model.phong != null) ? Model.phong.id : "") },
                success: function (data) {
                    var commentsHtml = '';
                    data.forEach(function (modeldata) {
                        if (modeldata.binhLuan.parent_comment_id == 0) {
                            // Hiển thị bình luận gốc
                            commentsHtml += `
                                                                                        <div class="container-comments" style="padding: 10px 20px;border: 1px solid #ccc;border-radius: 10px;">
                                                                                                <div class="comment">
                                                                                                <img src="" alt="" class="avatar">
                                                                                                <div class="comment-body">
                                                                                                    <div class="comment-header">
                                                                                                        ${modeldata.binhLuan.loainguoithamgia === 'khachhang' ?
                                                                                                        `<span class="username">${modeldata.khachhang.hovaten}</span>` :
                                                                                                        `<span class="username">${modeldata.nhanVien.hovaten}</span>`}
                                                                                                <span class="time">${formatTime(modeldata.binhLuan.thoigianbinhluan)}</span>
                                                                                                            </div>
                                                                                                    <p class="comment-text">${modeldata.binhLuan.noidung}</p>
                                                                                                    <div class="comment-actions">
                                                                                                        <button class="reply">Trả lời</button>
                                                                                                        <button id="thich" data-binhluan-id="${modeldata.binhLuan.id}" class="like">Thích <span>(${modeldata.binhLuan.thich})</span></button>
                                                                                                            <button id="khongthich" data-binhluan-id="${modeldata.binhLuan.id}" class="dislike">Không thích <span>(${modeldata.binhLuan.khongthich})</span></button>
                                                                                                    </div>
                                                                                                    <div class="reply-input" style="display: none;">
                                                                                                        <img src="" alt="" class="avatar">
                                                                                                        <textarea class="inputnoidung-reply" placeholder="Viết bình luận trả lời..."></textarea>
                                                                                                        <input type="hidden" class="parent_comment_id" value="${modeldata.binhLuan.id}" />
                                                                                                        <button class="add-comment-reply-btn" type="submit">Gửi</button>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>`;

                            // Hiển thị danh sách bình luận trả lời
                            commentsHtml += '<div class="replies-list">';
                            let replyCount = 0;
                            modeldata.listBinhLuan.forEach(function (reply) {
                                if (reply.trangthai === "Đã duyệt") {
                                    replyCount++;
                                    if (replyCount <= soluonghienthi) {
                                        commentsHtml += `
                                                                                            <div class="comment reply">
                                                                                                <img src="" alt="${reply.hovaten}" class="avatar">
                                                                                                <div class="comment-body">
                                                                                                    <div class="comment-header">
                                                                                                        <span class="username">${reply.hovaten}</span>
                                                                                                        <span class="time">${formatTime(reply.thoigianbinhluan)}</span>
                                                                                                    </div>
                                                                                                    <p class="comment-text">${reply.noidung}</p>
                                                                                                    <div class="comment-actions">
                                                                                                        <button class="reply">Trả lời</button>
                                                                                                        <button id="thich" data-binhluan-id="${reply.id}" class="like">Thích <span>(${reply.thich})</span></button>
                                                                                                        <button id="khongthich" data-binhluan-id="${reply.id}" class="dislike">Không thích <span>(${reply.khongthich})</span></button>
                                                                                                    </div>
                                                                                                    <div class="reply-input" style="display: none;">
                                                                                                        <img src="" alt="" class="avatar">
                                                                                                        <textarea class="inputnoidung-reply" placeholder="Viết bình luận trả lời..."></textarea>
                                                                                                        <input type="hidden" class="parent_comment_id" value="${reply.id}" />
                                                                                                        <button class="add-comment-reply-btn" type="submit">Gửi</button>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>`;
                                    }
                                }
                            });

                            if (replyCount > soluonghienthi) {
                                commentsHtml += `
                                                                                    <div class="view-more-replies">
                                                                                        <button class="btn-view-more-replies">Xem thêm</button>
                                                                                    </div>`;
                            } else if (replyCount > 0) {
                                commentsHtml += `
                                                                                        <div class="view-more-replies">
                                                                                           <button class="btn-view-more-repliess">Ẩn bớt</button>
                                                                                        </div>`;
                            }
                            commentsHtml += '</div>';
                            commentsHtml += '</div>';
                            commentsHtml += '<br>';
                        }
                    });

                    $('#comments-list').html(commentsHtml);
                },
                error: function (error) {
                    console.log('Error fetching comments:', error);
                }
            });
        }
        function formatTime(timestamp) {
            let date = new Date(timestamp);
            let hours = date.getHours();
            let minutes = date.getMinutes();

            // Formatting hours and minutes to ensure they are two digits
            let formattedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;

            return formattedTime;
        }

        // Gọi hàm loadComments với idphong
        let soluonghienthi = 3;
        loadComments(soluonghienthi);

        $('#comments-list').on('click', '.btn-view-more-replies', function () {
            soluonghienthi += 2;
            loadComments(soluonghienthi);
            var commentsSection = $('#comments-list');
            $('html, body').animate({
                scrollTop: commentsSection.offset().top + commentsSection.outerHeight() - window.innerHeight
            }, 500);
        });

        $('#comments-list').on('click', '.btn-view-more-repliess', function () {
            soluonghienthi -= 2;
            loadComments(soluonghienthi);
        });

        // Gắn sự kiện click cho nút reply sử dụng event delegation
        $('#comments-list').on('click', '.reply', function () {
            const replyInput = $(this).closest('.comment-body').find('.reply-input');
            replyInput.toggle();
        });

        // Gắn sự kiện click cho nút gửi bình luận chính
        $("#add-comment-btn").click(function () {
            var inputnoidung = $("#main-input").val();
            $.ajax({
                type: "POST",
                url: "/binhluan/addbinhluan",
                data: { idphong: @((Model.phong != null) ? Model.phong.id : ""), noidung: inputnoidung },
                success: function (data) {
                    $("#main-input").val('');
                    if (data.success) {
                        // Hiển thị thông báo thành công
                        $('.alert-success').text(data.message).show();
                        // Sau 5 giây tự động ẩn thông báo
                        setTimeout(function () {
                            $('.alert-success').fadeOut('fast');
                        }, 5000);
                        loadComments(soluonghienthi); // Tải lại bình luận
                    } else if (data.thongbao != null) {
                        $('.alert-login').text(data.thongbao).show();
                        $(".alert-login").html('Vui lòng ' + '<a data-bs-toggle="modal" data-bs-target="#exampleModal">Đăng nhập</a>' + ' trước khi bình luận !');
                    }
                },
                error: function (error) {
                    console.error(error);
                }
            });
        });

        /// thích bình luận
        $('#comments-list').on('click', '#thich', function () {
            var idbinhluan = $(this).data('binhluan-id');
            $.ajax({
                type: "POST",
                url: "/binhluan/ThichBinhLuan",
                data: { idbinhluan: idbinhluan },
                success: function (data) {
                    loadComments(soluonghienthi);
                },
                error: function (error) {
                    console.error(error);
                }
            });
        });

        // l=không thích bin hf luận
        $('#comments-list').on('click', '#khongthich', function () {
            var idbinhluan = $(this).data('binhluan-id');
            $.ajax({
                type: "POST",
                url: "/binhluan/KhongThichBinhLuan",
                data: { idbinhluan: idbinhluan },
                success: function (data) {
                    loadComments(soluonghienthi);
                },
                error: function (error) {
                    console.error(error);
                }
            });
        });


        // Gắn sự kiện click cho nút gửi bình luận trả lời sử dụng event delegation
        $('#comments-list').on('click', '.add-comment-reply-btn', function () {
            var inputnoidung = $(this).siblings('.inputnoidung-reply').val();
            var parent_comment_id = $(this).siblings('.parent_comment_id').val();
            $.ajax({
                type: "POST",
                url: "/binhluan/addbinhluans",
                data: { idphong: @((Model.phong != null) ? Model.phong.id : ""), noidung: inputnoidung, parent_comment_id: parent_comment_id },
                success: function (data) {
                    $("#main-input").val('');
                    if (data.success) {
                        // Hiển thị thông báo thành công
                        $('.alert-success').text(data.message).show();
                        // Sau 5 giây tự động ẩn thông báo
                        setTimeout(function () {
                            $('.alert-success').fadeOut('fast');
                        }, 5000);
                        loadComments(soluonghienthi); // Tải lại bình luận
                    } else if (data.thongbao != null) {
                        $('.alert-login').text(data.thongbao).show();
                        $(".alert-login").html('Vui lòng ' + '<a data-bs-toggle="modal" data-bs-target="#exampleModal">Đăng nhập</a>' + ' trước khi bình luận !');
                    }
                },
                error: function (error) {
                    console.error(error);
                }
            });
        });
        function loadLikesCount() {
            $.ajax({
                type: "GET",
                url: "/Likes/CountLikeByIdPhong",
                data: { idphong: @((Model.phong != null) ? Model.phong.id : "") },
                success: function (result) {
                    $("#totalLikes").text(result.sumlikesidphong);
                    $("#likeIcon").html('<i class="' + result.icon + ' icon"></i>');
                },
                error: function (error) {
                    console.error(error);
                }
            });
        }

        loadLikesCount();

        $(".icon").click(function () {
            var reaction = $(this).data("icon");
            $.ajax({
                type: "GET",
                url: "/Likes/LikesPhong",
                data: { idphong: @((Model.phong != null) ? Model.phong.id : ""), icon: reaction },
                success: function (data) {
                    loadLikesCount();
                    if (data.thongbao != null) {
                        $("#thongbao").html('Vui lòng ' + '<a href="/dangnhap/dangnhap">Đăng nhập</a>' + ' trước khi like !');
                    }
                },
                error: function (error) {
                    console.error(error);
                }
            });
        });
        $('#loginsss').click(function () {
            var taikhoanoremail = $('#exampleModal').find('.taikhoanoremail').val();
            var matkhau = $('#exampleModal').find('.matkhau').val();
            $.ajax({
                type: 'POST',
                url: '/dangnhap/DangNhapVaoHeThongs',
                data: { taikhoanoremail: taikhoanoremail, matkhau: matkhau },
                success: function (response) {
                    if (response.success) {
                        loadComments(soluonghienthi);
                        loadLikesCount();
                        $('.alert-login').hide();
                        $('#exampleModal').modal('hide');
                    } else {
                        alert('Đăng nhập thất bại! Vui lòng kiểm tra lại tài khoản và mật khẩu.');
                    }
                },
                error: function (error) {
                    console.error('Lỗi đăng nhập:', error);
                    alert('Đã xảy ra lỗi trong quá trình đăng nhập. Vui lòng thử lại sau.');
                }
            });
        });

    });
</script>
