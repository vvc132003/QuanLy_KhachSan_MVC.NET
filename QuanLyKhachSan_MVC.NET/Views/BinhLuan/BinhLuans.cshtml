<div class="comment-container" style="padding: 40px; max-width: 1000px; margin: auto; background: #f5f5f5; border-radius: 8px;">
    <div class="alert alert-success" style="display:none;">
    </div>
    <div class="comment-input">
        <img src="user-avatar.jpg" alt="User Avatar" class="avatar">
        <textarea id="main-input" class="inputnoidung" placeholder="Viết bình luận..."></textarea>
        <button id="add-comment-btn" type="submit">Gửi</button>
    </div>

    <div class="comments-list" id="comments-list">
        <!-- Bình luận sẽ được tải lên đây bởi AJAX -->
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        // Hàm gọi AJAX để lấy bình luận
        function loadComments() {
            $.ajax({
                url: '/binhluan/BinhLuanss?idphong=1',
                type: 'GET',
                success: function (data) {
                    var commentsHtml = '';
                    data.forEach(function (modeldata) {
                        if (modeldata.binhLuan.parent_comment_id == 0) {
                            // Hiển thị bình luận gốc
                            commentsHtml += `
                                    <div class="comment">
                                        <img src="user-avatar.jpg" alt="User Avatar" class="avatar">
                                        <div class="comment-body">
                                            <div class="comment-header">
                                                ${modeldata.binhLuan.loainguoithamgia === 'khachhang' ?
                                    `<span class="username">${modeldata.khachhang.hovaten}</span>` :
                                    `<span class="username">${modeldata.nhanVien.hovaten}</span>`}
                                                <span class="time">2 giờ trước</span>
                                            </div>
                                            <p class="comment-text">${modeldata.binhLuan.noidung}</p>
                                            <div class="comment-actions">
                                                <button class="reply">Trả lời</button>
                                                <button class="like">Thích</button>
                                                <button class="dislike">Không thích</button>
                                            </div>
                                            <div class="reply-input" style="display: none;">
                                                <img src="user-avatar.jpg" alt="User Avatar" class="avatar">
                                                <textarea class="inputnoidung-reply" placeholder="Viết bình luận trả lời..."></textarea>
                                                <input type="hidden" class="parent_comment_id" value="${modeldata.binhLuan.id}" />
                                                <button class="add-comment-reply-btn" type="submit">Gửi</button>
                                            </div>
                                        </div>
                                    </div>`;

                            // Hiển thị danh sách bình luận trả lời
                            commentsHtml += '<div class="replies-list">';
                            modeldata.listBinhLuan.forEach(function (reply) {
                                commentsHtml += `
                                        <div class="comment">
                                            <img src="user-avatar.jpg" alt="User Avatar" class="avatar">
                                            <div class="comment-body">
                                                <div class="comment-header">
                                                    <span class="username">${reply.hovaten}</span>
                                                    <span class="time">1 giờ trước</span>
                                                </div>
                                                <p class="comment-text">${reply.noidung}</p>
                                                <div class="comment-actions">
                                                    <button class="reply">Trả lời</button>
                                                    <button class="like">Thích</button>
                                                    <button class="dislike">Không thích</button>
                                                </div>
                                                <div class="reply-input" style="display: none;">
                                                    <img src="user-avatar.jpg" alt="User Avatar" class="avatar">
                                                    <textarea class="inputnoidung-reply" placeholder="Viết bình luận trả lời..."></textarea>
                                                    <input type="hidden" class="parent_comment_id" value="${reply.id}" />
                                                    <button class="add-comment-reply-btn" type="submit">Gửi</button>
                                                </div>
                                            </div>
                                        </div>`;
                            });
                            commentsHtml += '</div>'; // Đóng replies-list
                        }
                    });

                    $('#comments-list').html(commentsHtml);
                },
                error: function (error) {
                    console.log('Error fetching comments:', error);
                }
            });
        }

        // Gọi hàm loadComments với idphong
        loadComments();

        // Gắn sự kiện click cho nút reply sử dụng event delegation
        $('#comments-list').on('click', '.reply', function () {
            const replyInput = $(this).closest('.comment-body').find('.reply-input');
            replyInput.toggle();
        });

        // Gắn sự kiện click cho nút gửi bình luận chính
        $("#add-comment-btn").click(function () {
            var inputnoidung = $("#main-input").val();
            $.ajax({
                type: "POST",
                url: "/binhluan/addbinhluan",
                data: { idphong: 1, noidung: inputnoidung },
                success: function (data) {
                    $("#main-input").val('');
                    if (data.success) {
                        // Hiển thị thông báo thành công
                        $('.alert-success').text(data.message).show();
                        // Sau 5 giây tự động ẩn thông báo
                        setTimeout(function () {
                            $('.alert-success').fadeOut('fast');
                        }, 5000);
                        loadComments(); // Tải lại bình luận
                    }
                },
                error: function (error) {
                    console.error(error);
                }
            });
        });

        // Gắn sự kiện click cho nút gửi bình luận trả lời sử dụng event delegation
        $('#comments-list').on('click', '.add-comment-reply-btn', function () {
            var inputnoidung = $(this).siblings('.inputnoidung-reply').val();
            var parent_comment_id = $(this).siblings('.parent_comment_id').val();
            $.ajax({
                type: "POST",
                url: "/binhluan/addbinhluans",
                data: { idphong: 1, noidung: inputnoidung, parent_comment_id: parent_comment_id },
                success: function (data) {
                    if (data.success) {
                        // Hiển thị thông báo thành công
                        $('.alert-success').text(data.message).show();
                        // Sau 5 giây tự động ẩn thông báo
                        setTimeout(function () {
                            $('.alert-success').fadeOut('fast');
                        }, 5000);
                        loadComments(); // Tải lại bình luận
                    }
                },
                error: function (error) {
                    console.error(error);
                }
            });
        });
    });
</script>




<style>
    .comment-input {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        background: white;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

        .comment-input .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .comment-input textarea {
            flex: 1;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            resize: none;
            font-size: 14px;
        }

        .comment-input button {
            margin-left: 10px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

            .comment-input button:hover {
                background-color: #0056b3;
            }

    .comments-list .comment {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
        background: white;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .comments-list .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
    }

    .comments-list .comment-body {
        flex: 1;
    }

    .comments-list .comment-header {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
    }

    .comments-list .username {
        font-weight: bold;
        margin-right: 10px;
        font-size: 14px;
    }

    .comments-list .time {
        color: #888;
        font-size: 12px;
    }

    .comments-list .comment-text {
        margin-bottom: 10px;
        font-size: 14px;
    }

    .comments-list .comment-actions button {
        margin-right: 10px;
        background: none;
        border: none;
        color: #007bff;
        cursor: pointer;
        font-size: 14px;
        transition: color 0.3s;
    }

        .comments-list .comment-actions button:hover {
            color: #0056b3;
        }

    .reply-input {
        display: none;
        margin-left: 50px;
        margin-top: 10px;
    }

    .replies-list {
        margin-left: 50px;
        margin-top: 10px;
    }

        .replies-list .comment {
            margin-bottom: 10px;
        }

    .reply-input .avatar {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        margin-right: 10px;
    }

    .reply-input textarea {
        flex: 1;
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
        resize: none;
        font-size: 14px;
    }

    .reply-input button {
        margin-left: 10px;
        padding: 5px 10px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

        .reply-input button:hover {
            background-color: #0056b3;
        }
</style>

