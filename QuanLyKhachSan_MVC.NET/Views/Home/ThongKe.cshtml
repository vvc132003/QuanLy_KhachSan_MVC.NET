@model List<Model.Models.Modeldata>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel='stylesheet'
      href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<link href="~/content/static/morris.css" rel="stylesheet" />
<link href="~/content/static/c3.min.css" rel="stylesheet" />
<link href="~/content/static/style.css" rel="stylesheet" />
<link href="~/content/static/dashboard1.css" rel="stylesheet" />
<link href="~/css/kaiadmin.css" rel="stylesheet" />
@Html.Partial("~/Views/layout/logo.cshtml")
<link href="~/content/static/home.css" rel="stylesheet" />
<div class="skin-default-dark fixed-layout">
    <div id="main-wrapper">
        @Html.Partial("~/Views/layout/navbar.cshtml")
        @Html.Partial("~/Views/layout/header.cshtml")
        <div class="page-wrapper">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-3">
                        <div class="card card-stats card-round">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-icon">
                                        <div class="icon-big text-center icon-success bubble-shadow-small">
                                            <i class="fas fa-dollar-sign"></i>
                                        </div>
                                    </div>
                                    <div class="col col-stats ms-3 ms-sm-0">
                                        <div class="numbers">
                                            <p class="card-category">Doanh thu</p>
                                            <h4 class="card-title">
                                                @string.Format("{0:N0} VNĐ", @ViewData["tongDoanhThu"])
                                            </h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-2">
                        <div class="card card-stats card-round">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-icon">
                                        <div class="icon-big text-center icon-primary bubble-shadow-small">
                                            <i class="fas fa-users"></i>
                                        </div>
                                    </div>
                                    <div class="col col-stats ms-3 ms-sm-0">
                                        <div class="numbers">
                                            <p class="card-category">Khách hàng</p>
                                            <h4 class="card-title">@ViewData["tongSoLuongKhachHang"]</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="card card-stats card-round">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-icon">
                                        <div class="icon-big text-center icon-info bubble-shadow-small">
                                            <i class="fas fa-comment"></i>
                                        </div>
                                    </div>
                                    <div class="col col-stats ms-3 ms-sm-0">
                                        <div class="numbers">
                                            <p class="card-category">Bình luận</p>
                                            <h4 class="card-title">@ViewData["tongbinhluan"]</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-2">
                        <div class="card card-stats card-round">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-icon">
                                        <div class="icon-big text-center icon-secondary bubble-shadow-small">
                                            <i class="fas fa-heart"></i>
                                        </div>
                                    </div>
                                    <div class="col col-stats ms-3 ms-sm-0">
                                        <div class="numbers">
                                            <p class="card-category">Likes</p>
                                            <h4 class="card-title">@ViewData["tonglikes"]</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-2">
                        <div class="card card-stats card-round">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-icon">
                                        <div class="icon-big text-center icon-warning bubble-shadow-small">
                                            <i class="fas fa-shopping-bag"></i>
                                        </div>
                                    </div>
                                    <div class="col col-stats ms-3 ms-sm-0">
                                        <div class="numbers">
                                            <p class="card-category">Sản phẩm</p>
                                            <h4 class="card-title">@ViewData["tongsanpham"]</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-8">
                        <div class="card mb-3">
                            <div class="card-header">
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <select class="form-control" id="idngay">
                                            <option value="" selected>Ngày</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <select class="form-control" id="idthang">
                                            <option value="" selected>Tháng</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <select class="form-control" id="idnam">
                                            <option value="" selected>Năm</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                <div class="card">
                                    <div class="card-header">
                                        <div class="card-title">Sản phẩm thuê %</div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="pieChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-8">
                                <div class="card">
                                    <div class="card-header">
                                        <div class="card-title">Doanh thu theo tháng</div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="barChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        cds
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
<script src="/static/custom.min.js"></script>
<script src="/static/jquery-3.2.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var daySelect = document.getElementById('idngay');
        var monthSelect = document.getElementById('idthang');
        var yearSelect = document.getElementById('idnam');

        // Thêm các tùy chọn ngày
        for (var i = 1; i <= 31; i++) {
            var option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            daySelect.appendChild(option);
        }

        // Thêm các tùy chọn tháng
        var months = [
            'Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4',
            'Tháng 5', 'Tháng 6', 'Tháng 7', 'Tháng 8',
            'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'
        ];
        for (var i = 0; i < months.length; i++) {
            var option = document.createElement('option');
            option.value = i + 1; // Giá trị tháng bắt đầu từ 1
            option.textContent = months[i];
            monthSelect.appendChild(option);
        }

        // Thêm các tùy chọn năm (ví dụ từ 1900 đến 2100)
        var currentYear = new Date().getFullYear();
        for (var i = currentYear; i >= 1900; i--) {
            var option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            yearSelect.appendChild(option);
        }
    });

    function generateRandomColors(numColors) {
        var colors = [];
        for (var i = 0; i < numColors; i++) {
            var color = '#' + Math.random().toString(16).substr(-6);
            colors.push(color);
        }
        return colors;
    }
    $(document).ready(function () {

        function loadPieChart() {
            $.ajax({
                url: '/home/TongSoLuongThueSanPhamTheoPhanTram',
                type: 'GET',
                success: function (data) {
                    var chartData = data.map(item => item.phantramthue);
                    var labels = data.map(item => item.tensanpham);
                    var backgroundColors = generateRandomColors(data.length);

                    var pieChart = document.getElementById('pieChart').getContext('2d');
                    var myPieChart = new Chart(pieChart, {
                        type: 'pie',
                        data: {
                            datasets: [{
                                data: chartData,
                                backgroundColor: backgroundColors,
                                borderWidth: 0
                            }],
                            labels: labels
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            legend: {
                                position: 'bottom',
                                labels: {
                                    fontColor: 'rgb(154, 154, 154)',
                                    fontSize: 11,
                                    usePointStyle: true,
                                    padding: 20
                                }
                            },
                            tooltips: {
                                enabled: true,
                                callbacks: {
                                    label: function (tooltipItem, data) {
                                        var dataset = data.datasets[tooltipItem.datasetIndex];
                                        var currentValue = dataset.data[tooltipItem.index];
                                        var total = dataset.data.reduce(function (previousValue, currentValue, currentIndex, array) {
                                            return previousValue + currentValue;
                                        });
                                        var percentage = Math.round((currentValue / total) * 100);
                                        return `${currentValue} (${percentage}%)`;
                                    }
                                },
                                backgroundColor: 'rgba(0, 0, 0, 0.7)',
                                titleFontSize: 14,
                                titleFontColor: '#fff',
                                bodyFontColor: '#fff',
                                bodyFontSize: 12,
                                displayColors: false
                            },
                            pieceLabel: {
                                render: 'percentage',
                                fontColor: 'white',
                                fontSize: 14,
                                precision: 2,
                                overlap: true
                            },
                            layout: {
                                padding: {
                                    left: 20,
                                    right: 20,
                                    top: 20,
                                    bottom: 20
                                }
                            }
                        }
                    });
                },
                error: function (error) {
                    console.error('Error fetching pie chart data:', error);
                }
            });
        }

        var myBarChart;
        function loadBarChart(idthang) {
            $.ajax({
                url: '/home/DoanhThuTheoThang',
                type: 'GET',
                data: { idthang: idthang },
                success: function (data) {
                    var months, revenues;

                    if (idthang != null) {
                        // Load data for the specific month
                        months = [data.month];
                        revenues = [data.totalRevenue];
                    } else {
                        // Load data for all months
                        months = data.months;
                        revenues = data.revenues;
                    }

                    var backgroundColors = generateRandomColors(months.length);

                    var barChartCanvas = document.getElementById("barChart");
                    var barChartContext = barChartCanvas.getContext("2d");

                    // Hủy biểu đồ cũ nếu tồn tại
                    if (myBarChart) {
                        myBarChart.destroy();
                    }

                    // Tạo biểu đồ mới
                    myBarChart = new Chart(barChartContext, {
                        type: "bar",
                        data: {
                            labels: months,
                            datasets: [{
                                label: "Sales",
                                backgroundColor: backgroundColors,
                                borderColor: "rgb(23, 125, 255)",
                                data: revenues,
                            }],
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                yAxes: [{
                                    ticks: {
                                        beginAtZero: true,
                                    },
                                }],
                            },
                        },
                    });
                },
                error: function (error) {
                    console.error('Error fetching sales data:', error);
                }
            });
        }
        loadPieChart();
        loadBarChart();

        //// tìm kiếm loadBarChart
        $('#idthang').on('change', function () {
            var idthang = $(this).val();
            loadBarChart(idthang);
        });

    });
</script>